Given the following Java code snippet:
public class Teste {
  public static void main(String[] args) {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);

    SAXParserFactory factory = SAXParserFactory.newInstance();
    factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
    SAXParser parser = factory.newSAXParser();

    SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
    Schema schema = factory.newSchema(new File("schema.xsd"));
    Validator validator = schema.newValidator();
    validator.validate(new StreamSource(new File("input.xml")));
    XMLInputFactory factory = XMLInputFactory.newInstance();
    factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);
    XMLStreamReader reader = factory.createXMLStreamReader(new StringReader("<!DOCTYPE foo [<!ENTITY bar \"baz\">]><foo>&bar;</foo>"));
    while (reader.hasNext()) {
        int event = reader.next();
        if (event == XMLStreamConstants.ENTITY_REFERENCE) {
            if (!Arrays.asList("bar").contains(reader.getLocalName())) {
                throw new Exception("Invalid entity");
            }
        }
}


  }
}


the following improvements are recommended: rule key = java:S1066 message = Merge this if statement with the enclosing one., start line = 20, end line = 20, rule key = java:S112 message = Define and throw a dedicated exception instead of using a generic one., start line = 21, end line = 21, rule key = java:S1854 message = Remove this useless assignment to local variable "parser"., start line = 8, end line = 8, rule key = java:S1481 message = Remove this unused "parser" local variable., start line = 8, end line = 8, rule key = java:S1066 message = Merge this if statement with the enclosing one., start line = 20, end line = 20, rule key = java:S112 message = Define and throw a dedicated exception instead of using a generic one., start line = 21, end line = 21, rule key = java:S1854 message = Remove this useless assignment to local variable "parser"., start line = 8, end line = 8, rule key = java:S1481 message = Remove this unused "parser" local variable., start line = 8, end line = 8, rule key = java:S1066 message = Merge this if statement with the enclosing one., start line = 20, end line = 20, rule key = java:S112 message = Define and throw a dedicated exception instead of using a generic one., start line = 21, end line = 21, rule key = java:S1854 message = Remove this useless assignment to local variable "parser"., start line = 8, end line = 8, rule key = java:S1481 message = Remove this unused "parser" local variable., start line = 8, end line = 8, rule key = java:S1066 message = Merge this if statement with the enclosing one., start line = 20, end line = 20, rule key = java:S112 message = Define and throw a dedicated exception instead of using a generic one., start line = 21, end line = 21, rule key = java:S1854 message = Remove this useless assignment to local variable "parser"., start line = 8, end line = 8, rule key = java:S1481 message = Remove this unused "parser" local variable., start line = 8, end line = 8.
Please provide a revised version of the code snippet that applies the recommended improvements. Only the revised code snippet, without additional text.